<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <a href="/" class="logo">
                <i class="fas fa-music"></i>
                Music Bot Setup
            </a>
            <ul class="nav-links">
                <li><a href="/">Trang chủ</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="dashboard-header fade-in">
            <h1><i class="fas fa-cog"></i> Dashboard Setup Required</h1>
            <p>Cần thiết lập OAuth2 trong Discord Developer Portal trước khi sử dụng dashboard.</p>
        </div>

        <div class="servers-section fade-in">
            <div class="servers-grid" style="grid-template-columns: 1fr;">
                
                <!-- Step 1 -->
                <div class="server-card" style="border-left: 5px solid #5865F2;">
                    <h3><i class="fas fa-globe"></i> Bước 1: Mở Discord Developer Portal</h3>
                    <p>Truy cập Developer Portal để cấu hình OAuth2 redirect:</p>
                    <div style="margin: 1rem 0;">
                        <a href="https://discord.com/developers/applications/<%= clientId %>" 
                           target="_blank" class="discord-btn">
                            <i class="fas fa-external-link-alt"></i>
                            Mở Developer Portal
                        </a>
                    </div>
                    <p><strong>Application ID:</strong> <code><%= clientId %></code></p>
                </div>

                <!-- Step 2 -->
                <div class="server-card" style="border-left: 5px solid #57F287;">
                    <h3><i class="fas fa-link"></i> Bước 2: Thêm Redirect URI</h3>
                    <ol style="text-align: left; margin: 1rem 0;">
                        <li>Vào tab <strong>"OAuth2"</strong> ở sidebar bên trái</li>
                        <li>Trong phần <strong>"Redirects"</strong>, nhấn <strong>"Add Redirect"</strong></li>
                        <li>Nhập chính xác URI sau:</li>
                    </ol>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0; border: 2px dashed #57F287;">
                        <code style="color: #57F287; font-weight: bold; font-size: 1.1rem;"><%= redirectUri %></code>
                        <button onclick="copyToClipboard('<%= redirectUri %>')" class="manage-btn" style="margin-left: 1rem; padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <p><strong>4.</strong> Nhấn <strong>"Save Changes"</strong></p>
                </div>

                <!-- Step 3 -->
                <div class="server-card" style="border-left: 5px solid #FFA500;">
                    <h3><i class="fas fa-check-circle"></i> Bước 3: Kiểm tra Setup</h3>
                    <p>Sau khi hoàn thành bước 1 và 2, kiểm tra dashboard:</p>
                    <div style="margin: 1rem 0;">
                        <a href="/" class="discord-btn" style="background: #57F287;">
                            <i class="fas fa-play"></i>
                            Test Dashboard
                        </a>
                        <a href="/test-api" class="discord-btn" style="background: #FFA500; margin-left: 0.5rem;">
                            <i class="fas fa-bug"></i>
                            Debug API
                        </a>
                    </div>
                </div>

                <!-- Troubleshooting -->
                <div class="server-card" style="border-left: 5px solid #ed4245;">
                    <h3><i class="fas fa-exclamation-triangle"></i> Troubleshooting</h3>
                    <div style="text-align: left;">
                        <h4>❌ "Invalid OAuth2 redirect_uri"</h4>
                        <p>➡️ Chưa thêm redirect URI trong Developer Portal</p>
                        
                        <h4 style="margin-top: 1rem;">❌ "Failed to fetch guilds"</h4>
                        <p>➡️ Access token không hợp lệ, thử logout và login lại</p>
                        
                        <h4 style="margin-top: 1rem;">❌ "Cannot connect"</h4>
                        <p>➡️ Bot chưa chạy, sử dụng <code>npm start</code></p>
                    </div>
                </div>

                <!-- Current Status -->
                <div class="server-card" style="border-left: 5px solid #36a2eb;">
                    <h3><i class="fas fa-info-circle"></i> Trạng thái hiện tại</h3>
                    <div style="text-align: left;">
                        <p><i class="fas fa-check" style="color: #57F287;"></i> <strong>Bot đang chạy:</strong> test bot zenkho#3665</p>
                        <p><i class="fas fa-check" style="color: #57F287;"></i> <strong>Dashboard đang chạy:</strong> http://localhost:3000</p>
                        <p><i class="fas fa-check" style="color: #57F287;"></i> <strong>Client Secret:</strong> Đã cấu hình</p>
                        <p><i class="fas fa-question" style="color: #FFA500;"></i> <strong>OAuth2 Redirect:</strong> Cần kiểm tra trong Developer Portal</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="/js/dashboard.js"></script>
    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                showNotification('✅ Đã copy redirect URI!', 'success');
            }, function(err) {
                showNotification('❌ Không thể copy', 'error');
            });
        }

        // Auto-check setup status
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                showNotification('ℹ️ Hoàn thành setup để sử dụng dashboard', 'info');
            }, 1000);
        });
    </script>
</body>
</html>
