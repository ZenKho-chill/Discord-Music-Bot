<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <a href="/dashboard" class="logo">
                <i class="fas fa-music"></i>
                Music Bot Dashboard
            </a>
            <ul class="nav-links">
                <li class="user-nav-info">
                    <% if (user.avatar) { %>
                        <img src="<%= user.avatar %>" alt="Avatar" class="nav-user-avatar">
                    <% } else { %>
                        <div class="nav-user-avatar nav-user-avatar-fallback">
                            <%= user.username.charAt(0).toUpperCase() %>
                        </div>
                    <% } %>
                    <span class="nav-user-name"><%= user.global_name || user.username %></span>
                </li>
                <li><a href="/logout" class="logout-btn">ƒêƒÉng xu·∫•t</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="welcome-banner fade-in" style="
            background: linear-gradient(135deg, #5865F2 0%, #7289DA 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(88, 101, 242, 0.3);
        ">
            <i class="fas fa-star" style="font-size: 3rem; margin-bottom: 1rem; color: #FFD700;"></i>
            <h2 style="margin: 0 0 0.5rem 0; font-size: 2rem;">Ch√†o m·ª´ng ƒë·∫øn v·ªõi Music Bot Dashboard! üéâ</h2>
            <p style="margin: 0; font-size: 1.1rem; opacity: 0.9;">
                Qu·∫£n l√Ω Music Bot tr√™n c√°c server Discord c·ªßa b·∫°n m·ªôt c√°ch d·ªÖ d√†ng!
            </p>
        </div>

        <!-- Servers Section -->
        <div class="servers-section fade-in">
            
            <% if (typeof apiError !== 'undefined' && apiError) { %>
                <div style="text-align: center; padding: 3rem; background: rgba(255,255,255,0.95); border-radius: 15px; border-left: 5px solid #FFA500;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #FFA500; margin-bottom: 1rem;"></i>
                    <h3>L·ªói k·∫øt n·ªëi Discord API</h3>
                    <p><%= apiError %></p>
                    <button onclick="window.location.reload()" class="discord-btn" style="margin-top: 1rem;">
                        <i class="fas fa-refresh"></i> Th·ª≠ l·∫°i
                    </button>
                </div>
            <% } else if (serversWithBot.length === 0 && serversWithoutBot.length === 0) { %>
                <div style="text-align: center; padding: 3rem; background: rgba(255,255,255,0.95); border-radius: 15px;">
                    <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: #FFA500; margin-bottom: 1rem;"></i>
                    <h3>Kh√¥ng t√¨m th·∫•y server n√†o</h3>
                    <p>B·∫°n ch∆∞a tham gia server n√†o ho·∫∑c kh√¥ng c√≥ quy·ªÅn xem server.</p>
                </div>
            <% } else { %>
                
                <!-- Servers with Bot -->
                <% if (serversWithBot.length > 0) { %>
                    <div style="margin-bottom: 3rem;">
                        <h3 style="color: #57F287; margin-bottom: 1.5rem;">
                            <i class="fas fa-check-circle"></i> 
                            Server c√≥ Bot (<%= serversWithBot.length %>)
                        </h3>
                        <div class="servers-grid">
                            <% serversWithBot.forEach(function(server) { %>
                                <div class="server-card has-bot">
                                    <div class="server-info">
                                        <% if (server.icon) { %>
                                            <img src="https://cdn.discordapp.com/icons/<%= server.id %>/<%= server.icon %>.png" alt="<%= server.name %>" class="server-icon">
                                        <% } else { %>
                                            <div class="server-icon">
                                                <%= server.name.charAt(0).toUpperCase() %>
                                            </div>
                                        <% } %>
                                        <div class="server-details">
                                            <h4><%= server.name %></h4>
                                        </div>
                                    </div>
                                    
                                    <div class="bot-status">
                                        <div class="status-indicator status-online"></div>
                                        <span>Bot ƒëang ho·∫°t ƒë·ªông</span>
                                    </div>
                                    
                                    <a href="/server/<%= server.id %>" class="manage-btn">
                                        <i class="fas fa-cog"></i> Qu·∫£n l√Ω
                                    </a>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                <% } %>

                <!-- Servers without Bot -->
                <% if (serversWithoutBot.length > 0) { %>
                    <div>
                        <h3 style="color: #FFA500; margin-bottom: 1.5rem;">
                            <i class="fas fa-plus-circle"></i> 
                            Server ch∆∞a c√≥ Bot (<%= serversWithoutBot.length %>)
                        </h3>
                        <div class="servers-grid">
                            <% serversWithoutBot.forEach(function(server) { %>
                                <div class="server-card no-bot">
                                    <div class="server-info">
                                        <% if (server.icon) { %>
                                            <img src="https://cdn.discordapp.com/icons/<%= server.id %>/<%= server.icon %>.png" alt="<%= server.name %>" class="server-icon">
                                        <% } else { %>
                                            <div class="server-icon">
                                                <%= server.name.charAt(0).toUpperCase() %>
                                            </div>
                                        <% } %>
                                        <div class="server-details">
                                            <h4><%= server.name %></h4>
                                        </div>
                                    </div>
                                    
                                    <div class="bot-status">
                                        <div class="status-indicator status-offline"></div>
                                        <span>Bot ch∆∞a c√≥</span>
                                    </div>
                                    
                                    <a href="https://discord.com/api/oauth2/authorize?client_id=1381461005158191185&permissions=8&scope=bot&guild_id=<%= server.id %>" 
                                       target="_blank" class="manage-btn" style="background: #57F287;">
                                        <i class="fas fa-plus"></i> M·ªùi Bot
                                    </a>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                <% } %>
                
            <% } %>
        </div>

        <!-- Quick Actions -->
        <div style="margin-top: 3rem; text-align: center;">
            <h3 style="margin-bottom: 1.5rem; color: #333;">Thao t√°c nhanh</h3>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="https://discord.com/api/oauth2/authorize?client_id=1381461005158191185&permissions=8&scope=bot" 
                   target="_blank" class="discord-btn">
                    <i class="fas fa-plus"></i>
                    M·ªùi Bot v√†o Server m·ªõi
                </a>
                <a href="https://discord.gg/your-support-server" target="_blank" class="discord-btn" style="background: #57F287;">
                    <i class="fas fa-life-ring"></i>
                    H·ªó tr·ª£
                </a>
            </div>
        </div>
    </div>

    <script src="/js/dashboard.js"></script>
    
    <!-- Server-side data for client-side JavaScript -->
    <script type="application/json" id="server-data">
        {
            "hasRememberToken": <%- JSON.stringify(hasRememberToken) %>
        }
    </script>
    
    <script>
        // Add hover effects to server cards
        document.addEventListener('DOMContentLoaded', function() {
            const serverCards = document.querySelectorAll('.server-card');
            serverCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px) scale(1.02)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            // Add click animation to buttons
            const buttons = document.querySelectorAll('.manage-btn, .discord-btn');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });
            
            // Get server-side data from JSON script
            console.log('üîç Dashboard loaded, checking server-side data...');
            const serverData = JSON.parse(document.getElementById('server-data').textContent);
            const hasRememberTokenFromServer = serverData.hasRememberToken;
            console.log('üç™ Has remember token (server-side):', hasRememberTokenFromServer);
            
            // Show notification based on auto-login status from server
            if (hasRememberTokenFromServer) {
                console.log('üîê Showing auto-login notification');
                if (window.showNotification) {
                    setTimeout(() => {
                        window.showNotification('üîê T·ª± ƒë·ªông ƒëƒÉng nh·∫≠p th√†nh c√¥ng! Session s·∫Ω t·ª± ƒë·ªông gia h·∫°n.', 'success');
                    }, 500);
                }
            } else {
                console.log('üéµ Showing welcome notification');
                if (window.showNotification) {
                    setTimeout(() => {
                        window.showNotification('üéµ Ch√†o m·ª´ng ƒë·∫øn v·ªõi Music Bot Dashboard!', 'success');
                    }, 500);
                }
            }
        });

    </script>
</body>
</html>
